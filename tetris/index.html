<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
        height: 100vh;
        margin: 0;
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
      }

      #glass {
        width: 45vh;
        height: 90vh;
        border-left: 5px red solid;
        border-right: 5px red solid;
        border-bottom: 5px red solid;
        box-sizing: content-box;
        position: relative;
      }

      #grid {
        height: 100%;
        width: 100%;
        position: relative;
      }
      #vertical-lines, #horizontal-lines {
        height: 100%;
        width: 100%;
        box-sizing: border-box;
      }
      #vertical-lines {
        position: absolute;
        top: 0;
        left: 0;
        display: flex;
        flex-direction: row;
      }
        #horizontal-lines div {
          height: 5%;
          border-top: 1px solid gray;
          box-sizing: border-box;
        }
        #vertical-lines div {
          width: 10%;
          height: 100%;
          border-left: 1px solid gray;
        }

      #figure {
        position: absolute;
        right: 4.5vh;
        top: calc(50% - 2 * 4.5vh);
      }

      .figure {
        width: 18vh;
        height: 18vh;
        position: relative;
      }
      .figure .content-wrapper {
        width: calc(100% + 1.1px);
        height: calc(100% + 2.2px);
        position: absolute;
        left: -0.2px;
        top: -2.9px;
      }
        .figure .grid {
          height: 100%;
          width: 100%;
          position: relative;
        }

        .figure .grid > * {
          height: 100%;
          width: 100%;
        }
        .figure .grid .vertical-lines {
          position: absolute;
          top: 0;
          left: 0;
          display: flex;
          flex-direction: row;
        }
        .figure .grid * div {
          box-sizing: border-box;
        }
        .figure .grid .horizontal-lines div {
          height: 25%;
          border-bottom: 1px solid gray;
        }
        .figure .grid .horizontal-lines div:first-child {
          border-top: 1px solid red;
        }
        .figure .grid .horizontal-lines div:last-child {
          border-bottom: 1px solid red;
        }
        .figure .grid .vertical-lines div {
          width: 25%;
          height: 100%;
          border-right: 1px solid gray;
        }
        .figure .grid .vertical-lines div:first-child {
          border-left: 1px solid red;
        }
        .figure .grid .vertical-lines div:last-child {
          border-right: 1px solid red;
        }
        .figure .content {
          position: absolute;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
        }
        .figure .content div {
          position: absolute;
        }
        .figure .rotateLabel {
          width: 100%;
          position: absolute;
          top: calc(100% + 0.2em);
          text-align: center;
        }

      .figure[letter="I"] .content div {
        background-color: lightblue;
      }
      .figure[letter="I"][rotate="0"] .content div,
      .figure[letter="I"][rotate="180"] .content div {
        top: 0.5px;
        left: 25%;
        width: calc(25% - 1px);
        height: calc(100% - 1px);
      }
      .figure[letter="I"][rotate="90"] .content div, 
      .figure[letter="I"][rotate="270"] .content div {
        top: 25%;
        left: 1px;
        width: calc(100% - 2px);
        height: calc(25% - 1px);
      }

      .figure[letter="J"] .content div {
        background-color: blue;
      }
        .figure[letter="J"][rotate="0"] .content div:first-child {
          left: 75%;
          top: .5px;
          width: calc(25% - 1px);
          height: calc(75% - 1px);
        }
        .figure[letter="J"][rotate="0"] .content div:last-child {
          left: 50%;
          top: 50%;
          width: 25%;
          height: calc(25% - .5px);
        }
        .figure[letter="J"][rotate="90"] .content div:first-child {
          left: 25%;
          top: 50%;
          width: calc(75% - 1px);
          height: calc(25% - 1px);
        }
        .figure[letter="J"][rotate="90"] .content div:last-child {
          left: 25%;
          top: 25%;
          width: calc(25% - 1px);
          height: 25%;
        }
        .figure[letter="J"][rotate="180"] .content div:first-child {
          left: 25%;
          top: .5px;
          width: calc(25% - 1px);
          height: calc(75% - 1px);
        }
        .figure[letter="J"][rotate="180"] .content div:last-child {
          left: calc(50% - 1px);
          top: .5px;
          width: 25%;
          height: calc(25% - 1px);
        }
        .figure[letter="J"][rotate="270"] .content div:first-child {
          left: 25%;
          top: .5px;
          width: calc(75% - 1px);
          height: calc(25% - 1px);
        }
        .figure[letter="J"][rotate="270"] .content div:last-child {
          left: 75%;
          top: calc(25% - 1px);
          width: calc(25% - 1px);
          height: 25%;
        }


      .figure[letter="L"] .content div {
        background-color: orange;
      }
        .figure[letter="L"][rotate="0"] .content div:first-child {
          left: 0%;
          top: .5px;
          width: calc(25% - 0.5px);
          height: calc(50% + 2px);
        }
        .figure[letter="L"][rotate="0"] .content div:last-child {
          left: 0%;
          top: 50%;
          width: calc(50% - 1px);
          height: calc(25% - 1px);
        }
        .figure[letter="L"][rotate="90"] .content div:first-child {
          left: .5px;
          top: .5px;
          width: calc(75% - 1px);
          height: calc(25% - 1px);
        }
        .figure[letter="L"][rotate="90"] .content div:last-child {
          left: .5px;
          top: .5px;
          width: calc(25% - 1.2px);
          height: calc(50% - 1px);
        }
        .figure[letter="L"][rotate="180"] .content div:first-child {
          left: 25%;
          top: calc(0% + 0.05px);
          width: calc(50% - 1px);
          height: calc(25% - 0.7px);
        }
        .figure[letter="L"][rotate="180"] .content div:last-child {
          left: 50%;
          top: 24%;
          width: calc(25% - 1px);
          height: 50%;
        }
        .figure[letter="L"][rotate="270"] .content div:first-child {
          left: .5px;
          top: 50%;
          width: calc(75% - 0.9px);
          height: calc(25% - 1px);
        }
        .figure[letter="L"][rotate="270"] .content div:last-child {
          left: 50%;
          top: 25%;
          width: calc(25% - 1px);
          height: 25%;
        }


      .figure[letter="O"] .content div {
        position: absolute;
        top: 25%;
        left: 25%;
        background-color: yellow;
        width: calc(50% - 1px);
        height: calc(50% - 1px);
      }

      .figure[letter="S"] .content div {
        background-color: green
      }
        .figure[letter="S"][rotate="0"] .content div:first-child {
          left: 25%;
          top: 50%;
          width: calc(50% - 0.5px);
          height: 25%;
        }
        .figure[letter="S"][rotate="0"] .content div:last-child {
          left: calc(0% + 1px);
          top: 75%;
          width: calc(50% - 1.5px);
          height: 25%;
        }
        .figure[letter="S"][rotate="90"] .content div:first-child {
          left: 25%;
          top: 25%;
          width: 25%;
          height: 50%;
        }
        .figure[letter="S"][rotate="90"] .content div:last-child {
          left: 50%;
          top: 50%;
          width: 25%;
          height: 50%;
        }
        .figure[letter="S"][rotate="180"] .content div:first-child {
          left: 25%;
          top: 50%;
          width: calc(50% - 0.5px);
          height: 25%;
        }
        .figure[letter="S"][rotate="180"] .content div:last-child {
          left: calc(0% + 1px);
          top: 75%;
          width: calc(50% - 1.5px);
          height: 25%;
        }
        .figure[letter="S"][rotate="270"] .content div:first-child {
          left: 25%;
          top: 25%;
          width: 25%;
          height: 50%;
        }
        .figure[letter="S"][rotate="270"] .content div:last-child {
          left: 50%;
          top: 50%;
          width: 25%;
          height: 50%;
        }

      .figure[letter="T"] .content div {
        background-color: purple
      }
        .figure[letter="T"][rotate="0"] .content div:first-child {
          left: 0%;
          top: 75%;
          width: 75%;
          height: 25%;
        }
        .figure[letter="T"][rotate="0"] .content div:last-child {
          left: 25%;
          top: 50%;
          width: 25%;
          height: 25%;
        }
        .figure[letter="T"][rotate="90"] .content div:first-child {
          left: 0%;
          top: 25%;
          width: 25%;
          height: 75%;
        }
        .figure[letter="T"][rotate="90"] .content div:last-child {
          left: 25%;
          top: 50%;
          width: 25%;
          height: 25%;
        }
        .figure[letter="T"][rotate="180"] .content div:first-child {
          left: 0%;
          top: 25%;
          width: 75%;
          height: 25%;
        }
        .figure[letter="T"][rotate="180"] .content div:last-child {
          left: 25%;
          top: 50%;
          width: 25%;
          height: 25%;
        }
        .figure[letter="T"][rotate="270"] .content div:first-child {
          left: 50%;
          top: 25%;
          width: 25%;
          height: 75%;
        }
        .figure[letter="T"][rotate="270"] .content div:last-child {
          left: 25%;
          top: 50%;
          width: 25%;
          height: 25%;
        }

      .figure[letter="Z"] .content div {
        background-color: red
      }
        .figure[letter="Z"][rotate="0"] .content div:first-child {
          left: 0%;
          top: 50%;
          width: 50%;
          height: 25%;
        }
        .figure[letter="Z"][rotate="0"] .content div:last-child {
          left: 25%;
          top: 75%;
          width: 50%;
          height: 25%;
        }
        .figure[letter="Z"][rotate="90"] .content div:first-child {
          left: 25%;
          top: 50%;
          width: 25%;
          height: 50%;
        }
        .figure[letter="Z"][rotate="90"] .content div:last-child {
          left: 50%;
          top: 25%;
          width: 25%;
          height: 50%;
        }
        .figure[letter="Z"][rotate="180"] .content div:first-child {
          left: 0%;
          top: 50%;
          width: 50%;
          height: 25%;
        }
        .figure[letter="Z"][rotate="180"] .content div:last-child {
          left: 25%;
          top: 75%;
          width: 50%;
          height: 25%;
        }
        .figure[letter="Z"][rotate="270"] .content div:first-child {
          left: 25%;
          top: 50%;
          width: 25%;
          height: 50%;
        }
        .figure[letter="Z"][rotate="270"] .content div:last-child {
          left: 50%;
          top: 25%;
          width: 25%;
          height: 50%;
        }

    </style>
    <script>
      // == Шпаргалка
      // commit:
      //   CTRL+SHIFT+P
      //   Git:Status
      //   C
      //   ввести комментарий к коммиту
      //   CTRL+W
      // git push: "вытолкнуть" свои измения на сервер
      //   Win+R
      //   cmd.exe
      //   cd Documents\bikuzin.baza-winner.ru
      //   git push
      // git pull: "подтянуть" чужие изменения с сервера
      //   Win+R
      //   cmd.exe
      //   cd Documents\bikuzin.baza-winner.ru
      //   git pull
      (function() {
        'use strict';
        const figuresDef = {
          'I': {width: 1, height: 4, hasInner: false, matrix: {
            0: '1, 0, 0, 1, 0, 0',
            90: '0, 1.01, -.96, 0, 17, -50',
            180: '-.98, 0, 0, -.99, 0, 0',
            270: '0, -.99, .96, 0, 16.5, -50.5',
          }},
          'J': {width: 2, height: 3, hasInner: true, matrix: {
            0: '1, 0, 0, 1, 0, 0',
            90: '0, 1.01, -.96, 0, 0, 0',
            180: '-1, 0, 0, -1, 0, 0',
            270: '0, -.99, .96, 0, 0, 0',
          }},
          'L': {width: 2, height: 3, hasInner: true, matrix: {
            0: '1, 0, 0, 1, 0, 0',
            90: '0, 1.01, -.96, 0, 0, 0',
            180: '-1, 0, 0, -1, 0, 0',
            270: '0, -.99, .96, 0, 0, 0',
          }},
          'O': {width: 2, height: 2, hasInner: false, matrix: {
            0: '1, 0, 0, 1, 0, 0',
            90: '0, 1.01, -.96, 0, 0, 0',
            180: '-.98, 0, 0, -.99, 0, 0',
            270: '0, -.99, .96, 0, 0, 0',
          }},
          'S': {width: 3, height: 2, hasInner: true, matrix: {
            0: '1, 0, 0, 1, 0, 0',
            90: '0, 1.01, -.96, 0, 0, 0',
            180: '-.98, 0, 0, -.99, 0, 0',
            270: '0, -.99, .96, 0, 0, 0',
          }},
          'T': {width: 2, height: 3, hasInner: true, matrix: {
            0: '1, 0, 0, 1, 0, 0',
            90: '0, 1.01, -.96, 0, 0, 0',
            180: '-.98, 0, 0, -.99, 0, 0',
            270: '0, -.99, .96, 0, 0, 0',
          }},
          'Z': {width: 3, height: 2, hasInner: true, matrix: {
            0: '1, 0, 0, 1, 0, 0',
            90: '0, 1.01, -.96, 0, 0, 0',
            180: '-.98, 0, 0, -.99, 0, 0',
            270: '0, -.99, .96, 0, 0, 0',
          }},
        };

        function drawLines(id, count) {
          document.getElementById(id).innerHTML = '<div></div>'.repeat(count);
        }
        function createFigure(letter) {
          const result = document.createElement('div');
          result.className = 'figure ' + letter;
          if (figuresDef[letter].hasInner) {
            result.innerHTML = '<div></div>'.repeat(2);
          }
          const left = 'I' == letter ? '50%' : '40%';
          result.style = 'top: .05px; left: ' + left;
          return result;
        }
        let currentFigure, currentLetter, currentRotate, currentColor, currentPosition;
        document.addEventListener('DOMContentLoaded', function(event) {
          drawLines('horizontal-lines', 20);
          drawLines('vertical-lines', 10);
          currentFigure = document.getElementById('figure');
          setCurrentRotate();
          setCurrentColor();
          setCurrentLetter();
          setCurrentPosition();
        });
        function setHelper(newValue, valueName, defaultValue) {
          if (null != newValue) {
            sessionStorage.setItem(valueName, newValue);
          } else {
            newValue = sessionStorage.getItem(valueName); 
            if (null == newValue) {
              newValue = defaultValue;
            }
          }         
          return newValue;
        }
        function setCurrentRotate(newValue) {
          newValue = setHelper(newValue, 'currentRotate', 0);
          currentFigure.querySelector('.rotateLabel').innerText = newValue;
          currentFigure.setAttribute('rotate', newValue);
          currentRotate = parseInt(newValue, 10);
        }
        function setCurrentColor(newValue) {
          newValue = setHelper(newValue, 'currentColor', 'yellow');
          Array.prototype.slice
            .call(currentFigure.querySelectorAll('.content div'))
            .map(element => {
              element.style.backgroundColor = newValue;
            })
          ;
          currentColor = newValue;
        } 
        function setCurrentLetter(newValue) {
          newValue = setHelper(newValue, 'currentLetter', 'I');
          currentFigure.setAttribute('letter', newValue);
          currentLetter = newValue;
        }
        function setCurrentPosition(newValue) {
          newValue = setHelper(newValue, 'currentPosition', '');
          if ('' == newValue) {
            currentFigure.style.left = '';
          } else {
            currentFigure.style.left = 'calc(50% - 2 * 4.5vh)';
          }
          console.log(currentFigure.style.left);
          // currentFigure.setAttribute('letter', newValue);
          currentPosition = newValue;
        }
        document.addEventListener('keydown', function(event) {
          if ('ArrowUp' == event.code || 'ArrowDown' == event.code) {
            setCurrentRotate((360 + currentRotate + ('ArrowUp' == event.code ? 90 : -90)) % 360);
          } else if ('ArrowLeft' == event.code) {
            // if ()


          } else if ('ArrowRight' == event.code) {

          } else {
            let letter; 
            if (event.code.startsWith('Key') && 4 == event.code.length) letter = event.code[3];
            if (letter) {
              if (figuresDef[letter]) {
                setCurrentLetter(letter);
              } else if ('Y' == letter) {
                setCurrentColor('yellow');
              } else if ('B' == letter) {
                setCurrentColor('blue');
              } else if ('N' == letter) {
                setCurrentColor('');
              } else if ('G' == letter) {
                setCurrentPosition('' != currentPosition ? '' : '*');
              }
            }
          }

          // if (letter && figuresDef[letter]) {
            // if (currentFigure) {
            //   document.getElementById('glass').removeChild(currentFigure);
            // }
            // currentFigure = createFigure(event.code[3]);
            // document.getElementById('glass').appendChild(currentFigure);
            // currentFigure.style.transformOrigin = '50 50';
            // currentLetter = letter;
            // currentRotate = 0;
            // applyCurrentRotate();
          // } else if (currentFigure) {
            // const currentLeft = parseInt(currentFigure.style.left);
            // const currentRigth = currentLeft + figuresDef[currentLetter].width * 10;
            // if ('ArrowLeft' == event.code && currentLeft > 0) {
            //   currentFigure.style.left = (currentLeft - 10) + '%';
            // } else if ('ArrowRight' == event.code && currentRigth < 100) {
            //   currentFigure.style.left = (currentLeft + 10) + '%';
            // } else 

          // }
        });
      })();
    </script>
  </head>
  <body>
    <div id="glass">
      <div id="grid">
        <div id="horizontal-lines"></div>
        <div id="vertical-lines"></div>
      </div>
    </div>
    <div id="figure" class="figure">
      <div class="content-wrapper">
        <div class="grid">
          <div class="horizontal-lines">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
          </div>
          <div class="vertical-lines">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
          </div>
        </div>
        <div class="content">
          <div></div>
          <div></div>
        </div>
        <div class="rotateLabel"></div>
      </div>
    </div>
  </body>
</html>
